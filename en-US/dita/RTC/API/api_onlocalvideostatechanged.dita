<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="api_onlocalvideostatechanged">
    <title><ph keyref="onLocalVideoStateChanged" /></title>
    <shortdesc id="short"><ph id="shortdesc">Occurs when the local video stream state changes.</ph></shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="onLocalVideoStateChanged" />
            </keywords>
        </metadata>
    </prolog>
    <refbody><section id="prototype">
        <p outputclass="codeblock">
                <codeblock props="android" outputclass="language-java">public void onAudioMixingStateChanged(int state,int reason){ }</codeblock>
                <codeblock props="ios mac" outputclass="language-objectivec">- (void)rtcEngine:(AgoraRtcEngineKit * _Nonnull)engine localVideoStateChangedOfState:(AgoraVideoLocalState)state error:(AgoraLocalVideoStreamError)error;</codeblock>
                <codeblock props="windows" outputclass="language-cpp">virtual void onLocalVideoStateChanged(LOCAL_VIDEO_STREAM_STATE localVideoState, LOCAL_VIDEO_STREAM_ERROR error) { (void)localVideoState; (void)error; }</codeblock>
                <codeblock props="electron" outputclass="language-typescript">on(evt: EngineEvents.LOCAL_VIDEO_STATE_CHANGED, cb: ( localVideoState: number, error: number ) => void): this;</codeblock>
                <codeblock props="unity" outputclass="language-csharp"/>
                <codeblock props="rn" outputclass="language-typescript"/>
                <codeblock props="flutter" outputclass="language-dart"/>
        </p>
        </section>
        <section id="detailed_desc">
            <dl outputclass="since">
                <dlentry>
                    <dt>Since</dt>
                    <dd>v2.4.1</dd>
                </dlentry>
            </dl>
            <p id="desc1">When the state of the local video stream changes (including the state of the video capture and encoding), the SDK triggers this callback to report the current state. This callback indicates the state of the local video stream, including camera capturing and video encoding, and allows you to troubleshoot issues when exceptions occur.</p>
            <p>The SDK triggers the callback with the state code and error code in the following situations:<apiname keyref="onLocalVideoStateChanged"/><codeph><ph
                        keyref="LOCAL_VIDEO_STREAM_STATE_FAILED"/></codeph><codeph><ph
                        keyref="LOCAL_VIDEO_STREAM_ERROR_CAPTURE_FAILURE"/></codeph><ul>
                    <li>The app switches to the background, and the system gets the camera resource.</li>
                    <li>The camera starts normally, but does not output video for four consecutive seconds.</li>
                </ul>
            </p>
            <p>When the camera outputs the captured video frames, if the video frames are the same for 15 consecutive frames, the SDK triggers the callback with the state code and error code . Note that the video frame duplication detection is only available for video frames with a resolution greater than 200 × 200, a frame rate greater than or equal to 10 fps, and a bitrate less than 20 Kbps.<apiname keyref="onLocalVideoStateChanged" /><codeph><ph keyref="LOCAL_VIDEO_STREAM_STATE_CAPTURING"/></codeph><codeph><ph keyref="LOCAL_VIDEO_STREAM_ERROR_CAPTURE_FAILURE"/></codeph></p>
            <note id="note" type="attention">For some device models, the SDK does not trigger this callback when the state of the local video changes while the local video capturing device is in use, so you have to make your own timeout judgment.</note>
        </section>
        <section id="parameters">
            <title>Parameter</title>
            <parml>
                <plentry conkeyref="onJoinChannelSuccess/engine" props="ios mac">
                  <pt/>
                  <pd/>
              </plentry>
                <plentry>
                    <pt>localVideoState</pt>
                    <pd>
                        <p props="ios mac windows">The state of the local video, see <xref keyref="LOCAL_VIDEO_STREAM_STATE" />.</p>
                        <p props="android">
                            <ul>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_STATE_STOPPED"/> 0: The local video is in the initial state.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_STATE_CAPTURING"/> 1: The local video capturing device starts successfully.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_STATE_ENCODING"/> 2: The first video frame is successfully encoded.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_STATE_FAILED"/> 3: Fails to start the local video.</li>
                            </ul>
                        </p>
                    </pd>
                </plentry>
                <plentry>
                    <pt>error</pt>
                    <pd>
                        <p props="ios mac windows">The detailed error information, see <xref keyref="LOCAL_VIDEO_STREAM_ERROR" />.</p>
                        <p props="android">
                            <ul>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_OK"/> 0: The local video is normal.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_FAILURE"/> 1: No specified reason for the local video failure.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_DEVICE_NO_PERMISSION"
                                /> 2: No permission to use the local video capturing device.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_DEVICE_BUSY"/> 3: The local video capturing device is in use.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_CAPTURE_FAILURE"/> 4: The local video capture fails. Check whether the capturing device is working properly.<ul id="ul_ygj_tdx_qqb">
                                            <li>Android 9 及以上版本，app 切后台一段时间后，系统收回相机权限。</li>
                                        <li>Android 6 及以上版本，如果相机被第三方应用占用，且未被及时释放。 如果一段时间后，相机被释放，则 SDK 会再次出发该回调，并报告 <codeph>state</codeph> 为 <codeph>CAPTURING</codeph>，<codeph>error</codeph> 为 <codeph>ERROR_OK</codeph>。</li>
                                    </ul></li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_ENCODE_FAILURE"/> 5: The local video encoding fails.</li>
                                <li><ph keyref="LOCAL_VIDEO_STREAM_ERROR_DEVICE_NOT_FOUND"/> 8: Fails to find a local video capture device.</li>
                                <li><ph
                                        keyref="LOCAL_VIDEO_STREAM_ERROR_SCREEN_CAPTURE_WINDOW_MINIMIZED"
                                /> 11: When calling<xref keyref="startScreenCaptureByWindowId"/> to share the window, the shared window is in a minimized state.</li>
                                <li><ph
                                        keyref="LOCAL_VIDEO_STREAM_ERROR_SCREEN_CAPTURE_WINDOW_CLOSED"
                                /> 12: The error code indicates that a window shared by the window ID has been closed, or a full-screen window shared by the window ID has exited full-screen mode. After exiting full-screen mode, remote users cannot see the shared window. To prevent remote users from seeing a black screen, Agora recommends that you immediately stop screen sharing.</li>
                            </ul>
                        </p>
                    </pd>
                </plentry>
            </parml>
        </section>
    </refbody>
</reference>
