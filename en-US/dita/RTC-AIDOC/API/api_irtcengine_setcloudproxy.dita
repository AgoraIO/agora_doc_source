<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="api_irtcengine_setcloudproxy">
    <title><ph keyref="setCloudProxy"/></title>
    <shortdesc id="short"><ph id="shortdesc" props="cpp">Sets the cloud proxy service.</ph><ph id="shortdesc" props="android">Sets the cloud proxy service.</ph></shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="setCloudProxy"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
                <codeblock props="cpp" outputclass="language-cpp">virtual int setCloudProxy(CLOUD_PROXY_TYPE proxyType) = 0;</codeblock>
                <codeblock props="android" outputclass="language-java">public abstract int setCloudProxy(int proxyType);</codeblock>
            </p>
        </section>
        <section id="detailed_desc" deliveryTarget="details" otherprops="no-title">
            <dl outputclass="since">
                <dlentry props="cpp">
                    <dt>Since</dt>
                    <dd>Added in v3.3.0.</dd>
                </dlentry>
            </dl>
            <p props="cpp">When a user's network access is restricted by a firewall, you need to configure the firewall to allow access to specific IP addresses and ports provided by Agora, then call this method to enable the cloud proxy and set the proxy type using the <codeph>proxyType</codeph> parameter.

After successfully connecting to the cloud proxy, the SDK triggers the <xref keyref="onConnectionStateChanged"/> callback with state <codeph>CONNECTION_STATE_CONNECTING</codeph> and reason <codeph>CONNECTION_CHANGED_SETTING_PROXY_SERVER</codeph>.

To disable an already set cloud proxy, call <codeph>setCloudProxy(NONE_PROXY)</codeph>.

To change the cloud proxy type, first call <codeph>setCloudProxy(NONE_PROXY)</codeph>, then call <xref keyref="setCloudProxy"/> again to set a new <codeph>proxyType</codeph>.</p>
            <p props="android">When the user's network access is restricted by a firewall, you need to first configure the firewall to allow access to specific IP addresses and ports provided by Agora, then call this method to enable the cloud proxy and set the proxy type via the <codeph>proxyType</codeph> parameter. After successfully connecting to the cloud proxy, the SDK triggers the <xref keyref="onConnectionStateChanged"/> callback with the state <codeph>CONNECTION_STATE_CONNECTING</codeph> and reason <codeph>CONNECTION_CHANGED_SETTING_PROXY_SERVER</codeph>.

To disable the configured cloud proxy, call <xref keyref="setCloudProxy"/> and set <codeph>proxyType</codeph> to <codeph>TRANSPORT_TYPE_NONE_PROXY</codeph>.
To switch the cloud proxy type, first call <xref keyref="setCloudProxy"/> to disable the current proxy (<codeph>proxyType</codeph> set to <codeph>TRANSPORT_TYPE_NONE_PROXY</codeph>), then call <xref keyref="setCloudProxy"/> again to set the new <codeph>proxyType</codeph>.</p>
            <note props="cpp">
                <ul>
                    <li>It is recommended to call this method before joining a channel.</li>
                    <li>When the user is behind a firewall and using forced UDP cloud proxy, CDN streaming and cross-channel media relay are not available.</li>
                    <li>When using forced TCP cloud proxy, calling <codeph>startAudioMixing</codeph> to play online music files over HTTP will result in an error. CDN streaming and cross-channel media relay use TCP-based cloud proxy.</li>
                </ul>
            </note>
            <note props="android">
                <ul>
                    <li>It is recommended to call this method before joining a channel.</li>
                    <li>When the user is behind a firewall and uses forced UDP cloud proxy, media streaming and cross-channel media relay services are not available.</li>
                    <li>When using forced TCP cloud proxy, calling <codeph>startAudioMixing</codeph> to play online music files using the HTTP protocol will result in an error. Media streaming and cross-channel media relay services use TCP protocol cloud proxy.</li>
                </ul>
            </note>
        </section>
        <section id="related" deliveryTarget="details" props="cpp">
            <title>Related Callbacks</title>
            <p props="cpp">After successfully connecting to the cloud proxy, the SDK triggers the <xref keyref="onConnectionStateChanged"/> callback with state <codeph>CONNECTION_STATE_CONNECTING</codeph> and reason <codeph>CONNECTION_CHANGED_SETTING_PROXY_SERVER</codeph>.</p>
        </section>
        <section id="parameters" deliveryTarget="details" props="android cpp">
            <title>Parameters</title>
            <parml>
                <plentry props="cpp">
                    <pt>proxyType</pt>
                    <pd>Cloud proxy type. See <xref keyref="CLOUD_PROXY_TYPE"/>.</pd>
                </plentry>
                <plentry props="android">
                    <pt>proxyType</pt>
                    <pd>Type of cloud proxy:
                        <ul>
                            <li><codeph>TRANSPORT_TYPE_NONE_PROXY</codeph> (0): Auto mode. This is the default mode enabled by the SDK. In this mode, the SDK tries to connect to SD-RTNâ„¢ directly and automatically switches to TCP/TLS 443 if it fails.</li>
                            <li><codeph>TRANSPORT_TYPE_UDP_PROXY</codeph> (1): UDP protocol cloud proxy, i.e., forced UDP cloud proxy mode. In this mode, the SDK always transmits data via UDP.</li>
                            <li><codeph>TRANSPORT_TYPE_TCP_PROXY</codeph> (2): TCP (encrypted) protocol cloud proxy, i.e., forced TCP cloud proxy mode. In this mode, the SDK always transmits data via TCP/TLS 443.</li>
                        </ul>
                    </pd>
                </plentry>
            </parml>
        </section>
        <section id="return_values" props="android cpp">
            <title>Return Values</title>
            <p props="cpp">
                <ul>
                    <li>0: Success.</li>
                    <li>&lt; 0: Failure.
                        <ul>
                            <li>-2: Invalid parameter.</li>
                            <li>-7: SDK not initialized.</li>
                        </ul>
                    </li>
                </ul>
            </p>
            <p props="android">
                <ul>
                    <li>0: Success.</li>
                    <li>&lt; 0: Failure.
                        <ul>
                            <li>-2: Invalid parameter.</li>
                            <li>-7: SDK not initialized.</li>
                        </ul>
                    </li>
                </ul>
            </p>
        </section>
    </refbody>
</reference>