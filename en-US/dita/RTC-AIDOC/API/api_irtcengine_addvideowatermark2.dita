<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="api_irtcengine_addvideowatermark2">
    <title><ph keyref="addVideoWatermark2"/></title>
    <shortdesc id="short"><ph id="shortdesc" props="cpp">Adds a PNG watermark image to the local video.</ph><ph id="shortdesc" props="android">Adds a watermark image to the local video.</ph></shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="addVideoWatermark2"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
                <codeblock props="cpp" outputclass="language-cpp">virtual int addVideoWatermark(const char* watermarkUrl, const WatermarkOptions&amp; options) = 0;</codeblock>
                <codeblock props="android" outputclass="language-java">public abstract int addVideoWatermark(String watermarkUrl, WatermarkOptions options)</codeblock>
            </p>
        </section>
        <section id="detailed_desc" deliveryTarget="details" otherprops="no-title">
            <dl outputclass="deprecated">
                <dlentry props="cpp">
                    <dt>Deprecated</dt>
                    <dd>Deprecated since v4.5.0. Use <xref keyref="addVideoWatermark3"/> instead.</dd>
                </dlentry>
                <dlentry props="android">
                    <dt>Deprecated</dt>
                    <dd>Deprecated since v4.6.0. Use <xref keyref="addVideoWatermark3"/> instead.</dd>
                </dlentry>
            </dl>
            <p props="cpp">In live streaming, this method adds a PNG watermark image to the local video. After the watermark is added, all audience members in the channel (including CDN viewers) and capture devices can see and capture the image. The Agora SDK supports adding only one watermark image at a time. Adding a new image replaces the previous one.
The coordinates of the watermark image depend on the settings in the <xref keyref="setVideoEncoderConfiguration"/> method:
                <ul>
                    <li>If the orientation mode (<xref keyref="ORIENTATION_MODE"/>) of the encoded video is fixed landscape or adaptive landscape, the watermark image is in landscape mode.</li>
                    <li>If the orientation mode is fixed portrait or adaptive portrait, the watermark image is in portrait mode.</li>
                    <li>When setting the watermark position, the region must be smaller than the video dimensions set in <xref keyref="setVideoEncoderConfiguration"/>, otherwise the watermark image will be cropped.</li>
                </ul><ph>You can control whether the watermark is visible in the preview by setting the <codeph>visibleInPreview</codeph> parameter. However, its final visibility also depends on the video frame position (<codeph>position</codeph>) set in <xref keyref="setupLocalVideo"/>:</ph>
                <ul>
                    <li>Observation position <codeph>VIDEO_MODULE_POSITION_POST_CAPTURER</codeph> (default): if <codeph>visiblePreview</codeph> is <xref keyref="true"/>, the watermark is visible; if <xref keyref="false"/>, it is not.</li>
                    <li>Observation position <codeph>VIDEO_MODULE_POSITION_PRE_ENCODER</codeph>: if <codeph>visiblePreview</codeph> is <xref keyref="true"/>, the watermark is visible; if <xref keyref="false"/>, it is still visible.</li>
                </ul>
            </p>
            <p props="android">This method adds a PNG watermark image to the local video in a live broadcast. After adding the watermark, all viewers in the channel (including CDN viewers) and capture devices can see and capture the watermark image. The Agora SDK supports only one watermark image per live video stream. A newly added watermark replaces the previous one.
The watermark image position depends on the settings in the <xref keyref="setVideoEncoderConfiguration"/> method:
                <ul>
                    <li>If the orientation mode (<xref keyref="ORIENTATION_MODE"/>) of the encoded video is fixed landscape or adaptive landscape, the watermark uses landscape orientation.</li>
                    <li>If the orientation mode is fixed portrait or adaptive portrait, the watermark uses portrait orientation.</li>
                    <li>When setting the watermark position, the region must be smaller than the dimensions set in <xref keyref="setVideoEncoderConfiguration"/>, otherwise the watermark image will be cropped.</li>
                </ul><ph>You can control the watermark visibility during preview by setting the <codeph>visibleInPreview</codeph> parameter. However, its final effect also depends on the <codeph>position</codeph> parameter set in <xref keyref="setupLocalVideo"/> (the video frame's position in the video pipeline):</ph>
                <ul>
                    <li>Observation position <codeph>VIDEO_MODULE_POSITION_POST_CAPTURER</codeph> (default): <codeph>visiblePreview</codeph> is <xref keyref="true"/>, watermark is visible; <codeph>visiblePreview</codeph> is <xref keyref="false"/>, watermark is not visible.</li>
                    <li>Observation position <codeph>VIDEO_MODULE_POSITION_PRE_ENCODER</codeph>: <codeph>visiblePreview</codeph> is <xref keyref="true"/>, watermark is visible; <codeph>visiblePreview</codeph> is <xref keyref="false"/>, watermark is still visible.</li>
                </ul>
            </p>
            <note props="cpp">
                <ul>
                    <li>Make sure to call <xref keyref="enableVideo"/> before calling this method.</li>
                    <li>If you only want to add a watermark for media streaming, you can call this method or <xref keyref="startRtmpStreamWithTranscoding"/>.</li>
                    <li>This method only supports PNG format watermark images. Supported PNG pixel formats include RGBA, RGB, Palette, Gray, and Alpha_gray.</li>
                    <li>If the PNG image size does not match the settings in this method, the image will be cropped or scaled to fit.</li>
                    <li>If you enable mirroring for the local video, the watermark in the local video will also be mirrored. To avoid mirroring the watermark, Agora recommends not using both local video mirroring and watermark features simultaneously. You can implement the watermark at the application layer.</li>
                </ul>
            </note>
            <note props="android">
                <ul>
                    <li>Make sure to call <xref keyref="enableVideo"/> before calling this method.</li>
                    <li>If you only want to add a watermark for media streaming, you can call this method or <xref keyref="startRtmpStreamWithTranscoding"/>.</li>
                    <li>This method only supports watermark images in PNG format. Supported PNG pixel formats include RGBA, RGB, Palette, Gray, and Alpha_gray.</li>
                    <li>If the PNG image size does not match the settings in this method, the image will be cropped or scaled to fit.</li>
                    <li>If you enable mirror mode for the local video, the watermark in the local video will also be mirrored. To avoid this, Agora recommends not using both local video mirroring and watermark features simultaneously. You can implement watermarking at the application level.</li>
                </ul>
            </note>
        </section>
        <section id="parameters" deliveryTarget="details" props="android cpp">
            <title>Parameters</title>
            <parml>
                <plentry props="cpp">
                    <pt>watermarkUrl</pt>
                    <pd>The local file path of the watermark image to be added. Supports absolute or relative local paths.</pd>
                </plentry>
                <plentry props="cpp">
                    <pt>options</pt>
                    <pd>Options for the watermark image. See <xref keyref="WatermarkOptions"/>.</pd>
                </plentry>
                <plentry props="android">
                    <pt>watermarkUrl</pt>
                    <pd>The local file path of the watermark image to be added. Supports both absolute and relative local paths.</pd>
                </plentry>
                <plentry props="android">
                    <pt>options</pt>
                    <pd>Settings for the watermark image. See <xref keyref="WatermarkOptions"/>.</pd>
                </plentry>
            </parml>
        </section>
        <section id="return_values" props="android cpp">
            <title>Return Values</title>
            <p props="cpp">
                <ul>
                    <li>0: Success.</li>
                    <li>&lt; 0: Failure.</li>
                </ul>
            </p>
            <p props="android">
                <ul>
                    <li>0: Success.</li>
                    <li>&lt; 0: Failure.</li>
                </ul>
            </p>
        </section>
    </refbody>
</reference>