<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="api_irtcengine_joinchannelwithuseraccount2">
    <title><ph keyref="joinChannelWithUserAccount2"/></title>
    <shortdesc id="short"><ph id="shortdesc" props="cpp">Joins a channel using a user account and token, and sets media options.</ph><ph id="shortdesc" props="android">Joins a channel using a user account and token, and sets media options.</ph></shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="joinChannelWithUserAccount2"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
                <codeblock props="cpp" outputclass="language-cpp">virtual int joinChannelWithUserAccount(const char* token, const char* channelId, const char* userAccount, const ChannelMediaOptions&amp; options) = 0;</codeblock>
                <codeblock props="android" outputclass="language-java">public abstract int joinChannelWithUserAccount(String token, String channelName, String userAccount, ChannelMediaOptions options);</codeblock>
            </p>
        </section>
        <section id="detailed_desc" deliveryTarget="details" otherprops="no-title">
            <dl outputclass="since">
                <dlentry props="android">
                    <dt>Since</dt>
                    <dd>Available since v3.3.0.</dd>
                </dlentry>
            </dl>
            <p props="cpp">Before calling this method, if you have not called <xref keyref="registerLocalUserAccount"/> to register a user account, the SDK automatically creates a user account when you call this method to join a channel. Calling <xref keyref="registerLocalUserAccount"/> in advance can reduce the time needed to join the channel.

Compared with the <codeph>joinChannelWithUserAccount</codeph> method, this method adds the <codeph>options</codeph> parameter, which allows you to set media options in the channel, such as whether to publish audio and video streams.

By default, a user subscribes to all audio and video streams from other users in the channel, which results in usage and billing. To stop subscribing to other streams, set the <codeph>options</codeph> parameter or call <codeph>muteRemoteAudio/VideoStream</codeph> or <codeph>muteAllRemoteAudio/VideoStreams</codeph>.</p>
            <p props="android">This method adds the <codeph>options</codeph> parameter to set media options, such as whether to publish audio and video streams in the channel. By default, the user subscribes to all other users' audio and video streams in the channel, which incurs usage and billing. To stop subscribing to other streams, set the <codeph>options</codeph> parameter or call <codeph>muteRemoteAudio/VideoStream</codeph> or <codeph>muteAllRemoteAudio/VideoStreams</codeph>.</p>
            <note props="cpp">This method only supports joining one channel at a time.
Users with different App IDs cannot communicate with each other.
Before joining a channel, ensure that the App ID used to generate the token is the same as the App ID passed to the <xref keyref="initialize"/> method; otherwise, the channel join may fail.
To ensure smooth communication, use the same type of user identifier. For example, if one user joins the channel with a user ID, other users should also use a user ID; the same applies to using a user account. If a user joins the channel using the Agora Web SDK, make sure the parameter type of the user ID is consistent.</note>
            <note props="android">
                <ul>
                    <li>This method only supports joining one channel at a time.</li>
                    <li>Users with different App IDs cannot communicate with each other.</li>
                    <li>Before joining a channel, ensure that the App ID used to generate the token is the same as the one passed in the <xref keyref="initialize"/> method. Otherwise, joining the channel may fail due to token mismatch.</li>
                    <li>To ensure smooth communication, use the same identifier type for users. For example, if one user joins using a user ID, other users should also use a user ID; the same applies to user accounts. If a user joins the channel using the Agora Web SDK, ensure the user ID type is consistent.</li>
                </ul>
            </note>
        </section>
        <section id="timing" deliveryTarget="details" props="android cpp">
            <title>Timing</title>
            <p props="cpp">Call this method after calling the <xref keyref="initialize"/> method.</p>
            <p props="android">Call this method after calling the <xref keyref="initialize"/> method.</p>
        </section>
        <section id="related" deliveryTarget="details" props="android cpp">
            <title>Related Callbacks</title>
            <p props="cpp">After this method is successfully called, the SDK triggers the following callbacks:
                <ul>
                    <li>Local client: <xref keyref="onLocalUserRegistered"/>, <xref keyref="onJoinChannelSuccess"/>, and <xref keyref="onConnectionStateChanged"/>.</li>
                    <li>Remote client: If the user joins the channel in the COMMUNICATION profile, or a host joins in the LIVE_BROADCASTING profile, the <xref keyref="onUserJoined"/> and <xref keyref="onUserInfoUpdated"/> callbacks are triggered.</li>
                </ul>
            </p>
            <p props="android">Local client: <xref keyref="onLocalUserRegistered"/>, <xref keyref="onJoinChannelSuccess"/>, and <xref keyref="onConnectionStateChanged"/> callbacks.
Remote client: If a user joins the channel in the <codeph>COMMUNICATION</codeph> profile, or a host joins in the <codeph>LIVE_BROADCASTING</codeph> profile, the <xref keyref="onUserJoined"/> and <xref keyref="onUserInfoUpdated"/> callbacks are triggered.</p>
        </section>
        <section id="parameters" deliveryTarget="details" props="android cpp">
            <title>Parameters</title>
            <parml>
                <plentry props="cpp">
                    <pt>token</pt>
                    <pd>The token generated on your server for authentication.
                        <note>
                            <ul>
                                <li>(Recommended) If your project has enabled the security mode (authentication using App ID and token), this parameter is required.</li>
                                <li>If you have only enabled the testing mode (authentication using App ID), this parameter is optional. After successfully joining the channel, you will automatically leave the channel after 24 hours.</li>
                                <li>If you need to join multiple channels or switch between channels, Agora recommends using a wildcard token so that you do not need to request a new token each time you join a channel.</li>
                            </ul>
                        </note>
                    </pd>
                </plentry>
                <plentry props="cpp">
                    <pt>channelId</pt>
                    <pd>The channel name. This parameter specifies the channel for real-time audio and video interaction. Users with the same App ID and channel name join the same channel for audio and video interaction. The string length must be less than 64 bytes. Supported characters (89 total):
                        <ul>
                            <li>All lowercase letters: a to z.</li>
                            <li>All uppercase letters: A to Z.</li>
                            <li>All numeric characters: 0 to 9.</li>
                            <li>"!", "#", "$", "%", "&amp;", "(", ")", "+", "-", ":", ";", "&lt;", "=", ".", "&gt;", "?", "@", "[", "]", "^", "_", "{", "}", "|", "~", ",".</li>
                        </ul>
                    </pd>
                </plentry>
                <plentry props="cpp">
                    <pt>userAccount</pt>
                    <pd>The user account. Used to identify the user in the channel for real-time audio and video interaction. You need to set and manage the user account yourself and ensure that each user account in the same channel is unique. The maximum length of this parameter is 255 bytes and it cannot be empty. Supported characters (89 total):
                        <ul>
                            <li>26 lowercase letters: a to z.</li>
                            <li>26 uppercase letters: A to Z.</li>
                            <li>All numeric characters: 0 to 9.</li>
                            <li>Space</li>
                            <li>"!", "#", "$", "%", "&amp;", "(", ")", "+", "-", ":", ";", "&lt;", "=", ".", "&gt;", "?", "@", "[", "]", "^", "_", "{", "}", "|", "~", ",".</li>
                        </ul>
                    </pd>
                </plentry>
                <plentry props="cpp">
                    <pt>options</pt>
                    <pd>Channel media options. See <xref keyref="ChannelMediaOptions"/>.</pd>
                </plentry>
                <plentry props="android">
                    <pt>token</pt>
                    <pd>The token generated on your server for authentication.
                        <note>
                            <ul>
                                <li>(Recommended) If your project enables secure mode (authentication using App ID and token), this parameter is required.</li>
                                <li>If you enable only test mode (authentication using App ID), this parameter is optional. The user will automatically leave the channel after 24 hours.</li>
                                <li>If you need to join multiple channels or switch between channels, Agora recommends using a wildcard token so you don't need to request a new token each time.</li>
                            </ul>
                        </note>
                    </pd>
                </plentry>
                <plentry props="android">
                    <pt>channelName</pt>
                    <pd>The channel name. Users with the same channel name under the same App ID will join the same channel for audio and video interaction. The string length must be less than 64 bytes. Supported characters (89 total):
                        <ul>
                            <li>All lowercase English letters: a to z.</li>
                            <li>All uppercase English letters: A to Z.</li>
                            <li>All numeric characters: 0 to 9.</li>
                            <li>"!", "#", "$", "%", "&amp;", "(", ")", "+", "-", ":", ";", "&lt;", "=", ".", "&gt;", "?", "@", "[", "]", "^", "_", "{", "}", "|", "~", ","</li>
                        </ul>
                    </pd>
                </plentry>
                <plentry props="android">
                    <pt>userAccount</pt>
                    <pd>The user account. You need to set and manage user accounts yourself and ensure each user account is unique within the same channel. The maximum length of this parameter is 255 bytes and it cannot be empty. Supported characters (89 total):
                        <ul>
                            <li>26 lowercase English letters: a to z.</li>
                            <li>26 uppercase English letters: A to Z.</li>
                            <li>All numeric characters: 0 to 9.</li>
                            <li>Space</li>
                            <li>"!", "#", "$", "%", "&amp;", "(", ")", "+", "-", ":", ";", "&lt;", "=", ".", "&gt;", "?", "@", "[", "]", "^", "_", "{", "}", "|", "~", ","</li>
                        </ul>
                    </pd>
                </plentry>
                <plentry props="android">
                    <pt>options</pt>
                    <pd>Channel media options. See <xref keyref="ChannelMediaOptions"/>.</pd>
                </plentry>
            </parml>
        </section>
        <section id="return_values" props="android cpp">
            <title>Return Values</title>
            <p props="cpp">
                <ul>
                    <li>0: Success.</li>
                    <li>&lt; 0: Failure.
                        <ul>
                            <li>-2: Invalid parameter. For example, the token is invalid, the <codeph>uid</codeph> parameter is not set to an integer, or a value in <xref keyref="ChannelMediaOptions"/> is invalid. You need to pass in valid parameters and rejoin the channel.</li>
                            <li>-3: <xref keyref="IRtcEngine"/> object failed to initialize. You need to reinitialize the <xref keyref="IRtcEngine"/> object.</li>
                            <li>-7: <xref keyref="IRtcEngine"/> object is not initialized. You need to initialize the <xref keyref="IRtcEngine"/> object before calling this method.</li>
                            <li>-8: Internal state error of the <xref keyref="IRtcEngine"/> object. A typical cause is calling this method to join a channel after starting an echo test with <xref keyref="startEchoTest3"/> but not stopping it with <xref keyref="stopEchoTest"/>. You need to call <xref keyref="stopEchoTest"/> before calling this method.</li>
                            <li>-17: The request to join the channel is rejected. A typical cause is that the user is already in the channel. Agora recommends using the <xref keyref="onConnectionStateChanged"/> callback to check if the user is in the channel. Only call this method when the state is <codeph>CONNECTION_STATE_DISCONNECTED</codeph> (1).</li>
                            <li>-102: Invalid channel name. You need to pass a valid channel name in <codeph>channelId</codeph> to rejoin the channel.</li>
                            <li>-121: Invalid user ID. You need to pass a valid user ID in <codeph>uid</codeph> to rejoin the channel.</li>
                        </ul>
                    </li>
                </ul>
            </p>
            <p props="android">
                <ul>
                    <li>0: Success.</li>
                    <li>&lt; 0: Failure.
                        <ul>
                            <li>-2: Invalid parameter. For example, the token is invalid, the <codeph>uid</codeph> parameter is not set to an integer, or a member in <xref keyref="ChannelMediaOptions"/> has an invalid value. Pass in valid parameters and rejoin the channel.</li>
                            <li>-3: Failed to initialize the <xref keyref="IRtcEngine"/> object. Reinitialize the <xref keyref="IRtcEngine"/> object.</li>
                            <li>-7: The <xref keyref="IRtcEngine"/> object is not initialized. Initialize the <xref keyref="IRtcEngine"/> object before calling this method.</li>
                            <li>-8: The <xref keyref="IRtcEngine"/> object is in an incorrect internal state. A typical cause is calling this method to join a channel after calling <xref keyref="startEchoTest3"/> without stopping the test via <xref keyref="stopEchoTest"/>. Call <xref keyref="stopEchoTest"/> before calling this method.</li>
                            <li>-17: The join channel request was rejected. A typical cause is that the user is already in the channel. Agora recommends using the <xref keyref="onConnectionStateChanged"/> callback to determine whether the user is in the channel. Only call this method again when the state is <codeph>CONNECTION_STATE_DISCONNECTED</codeph> (1).</li>
                            <li>-102: Invalid channel name. Pass in a valid channel name in <codeph>channelId</codeph> and rejoin the channel.</li>
                            <li>-121: Invalid user ID. Pass in a valid user ID in <codeph>uid</codeph> and rejoin the channel.</li>
                        </ul>
                    </li>
                </ul>
            </p>
        </section>
    </refbody>
</reference>