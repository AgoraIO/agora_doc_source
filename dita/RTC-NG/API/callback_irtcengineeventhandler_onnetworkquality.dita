<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="callback_irtcengineeventhandler_onnetworkquality">
    <title><ph keyref="onNetworkQuality"/></title>
    <shortdesc id="short"><ph id="shortdesc">报告频道中每个用户的最后一公里网络质量。</ph></shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="onNetworkQuality"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
            <codeblock props="android" outputclass="language-java">public void onNetworkQuality(int uid, int txQuality, int rxQuality)</codeblock>
            <codeblock props="hmos" outputclass="language-arkts">onNetworkQuality? : (uid: number, txQuality: Constants.NetworkQuality, rxQuality: Constants.NetworkQuality) =&gt; void;</codeblock>
            <codeblock props="ios mac" outputclass="language-objectivec">- (void)rtcEngine:(AgoraRtcEngineKit * _Nonnull)engine networkQuality:(NSUInteger)uid txQuality:(AgoraNetworkQuality)txQuality rxQuality:(AgoraNetworkQuality)rxQuality NS_SWIFT_NAME(rtcEngine(_:networkQuality:txQuality:rxQuality:));</codeblock>
            <codeblock props="cpp unreal" outputclass="language-cpp">virtual void onNetworkQuality(uid_t uid, int txQuality, int rxQuality)</codeblock>
         <codeblock props="bp" outputclass="language-cpp">UFUNCTION(BlueprintNativeEvent, Category = "Agora|Event")
	void OnNetworkQuality(int64 uid, int txQuality, int rxQuality);</codeblock>
            <codeblock props="electron" outputclass="language-typescript">  onNetworkQuality?(
    connection: RtcConnection,
    remoteUid: number,
    txQuality: QualityType,
    rxQuality: QualityType
  ): void;</codeblock>
            <codeblock props="unity cs" outputclass="language-csharp">public virtual void OnNetworkQuality(RtcConnection connection, uint remoteUid, int txQuality, int rxQuality) {}</codeblock>
            <codeblock props="rn" outputclass="language-typescript">  onNetworkQuality?(
    connection: RtcConnection,
    remoteUid: number,
    txQuality: QualityType,
    rxQuality: QualityType
  ): void;</codeblock>
            <codeblock props="flutter" outputclass="language-dart">final void Function(RtcConnection connection, int remoteUid,
      QualityType txQuality, QualityType rxQuality)? onNetworkQuality;</codeblock>
            <codeblock props="reserve" outputclass="language-cpp"/></p>
        </section>
        <section id="detailed_desc">
            <p id="desc1">该回调报告频道中每个用户的最后一公里网络状况，即本地设备与声网边缘服务器之间的连接。SDK 每两秒触发一次该回调；如果频道中有多个用户，SDK 会触发多次。该回调通过在频道内发送和接收广播数据包反馈网络质量。为避免广播风暴导致频道内数据量激增，该回调默认最多反馈 4 个远端主机的网络质量。</p>
            <p id="desc2">该回调每 2 秒触发一次。如果远端有多个用户，该回调每 2 秒会被触发多次。</p>
            <p>该回调通过频道内的广播包反馈网络质量。过多的广播包可能引发广播风暴。为防止广播风暴导致频道内大量数据传输，该回调默认支持同时反馈最多 4 个远端主播的网络质量。</p>
            <note type="note"><ph>用户不发流时，<parmname>txQuality</parmname> 为 <codeph props="android bp cpp hmos unity unreal">UNKNOWN</codeph><codeph props="apple electron flutter rn">Unknown</codeph>；用户不收流时，<parmname>rxQuality</parmname> 为 <codeph props="android bp cpp hmos unity unreal">UNKNOWN</codeph><codeph props="apple electron flutter rn">Unknown</codeph>。</ph></note> <note type="attention" props="native"><codeph>txQuality</codeph> 在用户未发送流时为 <ph keyref="Unknown"/>；<codeph>rxQuality</codeph> 在用户未接收流时为 </note>
            </section>
        <section id="timing" deliveryTarget="details">
            <title>调用时机</title>
            <p>SDK 每两秒触发一次该回调。</p>
        </section>
        <section id="parameters">
            <title><ph keyref="callback-section-title"/></title>
            <parml>
            <plentry conkeyref="onJoinChannelSuccess/engine" props="apple">
                <pt/>
                <pd/>
            </plentry>
            <plentry props="cs electron flutter rn unity">
                <pt>connection</pt>
                <pd>Connection 信息。详见 <xref keyref="RtcConnection"/>。</pd>
            </plentry>
            <plentry id="uid">
                <pt props="bp native unreal">uid</pt>
                <pt props="cs electron flutter rn unity">remoteUid</pt>
                <pd>
                    <p>用户 ID。表示该回调报告的是持有该 ID 的用户的网络质量。如果当 uid 为 0 时，返回的是本地用户的网络质量。</p>
                </pd>
            </plentry>
            <plentry id="txQuality">
                <pt>txQuality</pt>
                <pd props="bp cs electron flutter mac rn unity unreal">该用户的上行网络质量，基于发送码率、上行丢包率、平均往返时延和网络抖动计算。 该值代表当前的上行网络质量，帮助判断是否可以支持当前设置的视频编码属性。 假设上行码率是 1000 Kbps，那么支持直播场景下 640 × 480 的分辨率、15 fps 的帧率没有问题，但是支持 1280 × 720 的分辨率就会有困难。<ph props="apple cpp cs electron flutter hmos unity unreal">详见 <xref keyref="QUALITY_TYPE"/>。</ph>
                    <ul conkeyref="RemoteAudioStats/qualitytype" props="android bp">
                    <li/>
                    </ul> </pd>
            <pd props="android">用户的上行网络质量评分，依据传输码率、丢包率、平均往返时延（RTT）和上行网络抖动等指标评估。
                    <ul>
                        <li><ph keyref="QUALITY_UNKNOWN"/> (0)：网络质量未知。</li>
                        <li><ph keyref="QUALITY_EXCELLENT"/> (1)：网络质量极好。</li>
                        <li><ph keyref="QUALITY_GOOD"/> (2)：网络质量较好，但码率可能略低于极好。</li>
                        <li><ph keyref="QUALITY_POOR"/> (3)：用户可能会感受到轻微的通话质量下降。</li>
                        <li><ph keyref="QUALITY_BAD"/> (4)：用户无法流畅地进行通话。</li>
                        <li><ph keyref="QUALITY_VBAD"/> (5)：网络质量极差，用户几乎无法进行通话。</li>
                        <li><ph keyref="QUALITY_DOWN"/> (6)：网络连接已断开，用户无法进行通话。</li>
                        <li><ph keyref="QUALITY_DETECTING"/> (8)：正在进行最后一公里探测测试。</li>
                        </ul>
                    </pd>
                <pd props="ios">用户的上行网络质量评分，基于传输码率、丢包率、平均往返时延（RTT）和抖动等指标。该参数用于帮助你了解当前上行网络状况是否能支持所选的视频编码器配置。例如，1000 Kbps 的上行网络可能足以支持在 <codeph>LIVE_BROADCASTING</codeph> 场景中分辨率为 640 × 480、帧率为 15 fps 的视频帧，但可能不足以支持高于 1280 × 720 的分辨率。详见 <xref keyref="QUALITY_TYPE"/>。</pd>
                <pd props="cpp">用户的上行网络质量评分，基于传输码率、丢包率、平均往返时延（RTT）和上行网络抖动等指标。该评分有助于评估当前上行网络状况对所选视频编码配置的支持程度。例如，1000 Kbps 的上行网络可能足以支持分辨率为 640 × 480、帧率为 15 fps 的视频帧（在极速直播场景中），但可能不足以支持高于 1280 × 720 的分辨率。详见 <xref keyref="QUALITY_TYPE"/>。</pd>
                </plentry>
            <plentry id="rxQuality">
                <pt>rxQuality</pt>
                <pd props="bp cs electron flutter mac rn unity unreal">该用户的下行网络质量，基于下行网络的丢包率、平均往返延时和网络抖动计算。<ph props="apple cpp cs electron flutter hmos unity unreal">详见 <xref keyref="QUALITY_TYPE"/>。</ph>
                    <ul conkeyref="RemoteAudioStats/qualitytype" props="android bp">
                    <li/>
                    </ul></pd>
            <pd props="android">用户的下行网络质量评分，依据丢包率、平均往返时延（RTT）和下行网络抖动等指标评估。
                    <ul>
                        <li><ph keyref="QUALITY_UNKNOWN"/> (0)：网络质量未知。</li>
                        <li><ph keyref="QUALITY_EXCELLENT"/> (1)：网络质量极好。</li>
                        <li><ph keyref="QUALITY_GOOD"/> (2)：网络质量较好，但码率可能略低于极好。</li>
                        <li><ph keyref="QUALITY_POOR"/> (3)：用户可能会感受到轻微的通话质量下降。</li>
                        <li><ph keyref="QUALITY_BAD"/> (4)：用户无法流畅地进行通话。</li>
                        <li><ph keyref="QUALITY_VBAD"/> (5)：网络质量极差，用户几乎无法进行通话。</li>
                        <li><ph keyref="QUALITY_DOWN"/> (6)：网络连接已断开，用户无法进行通话。</li>
                        <li><ph keyref="QUALITY_DETECTING"/> (8)：正在进行最后一公里探测测试。</li>
                        </ul>
                    </pd>
                <pd props="ios">用户的下行网络质量评分，基于丢包率、平均 RTT 和抖动等指标。详见 <xref keyref="QUALITY_TYPE"/>。</pd>
                <pd props="cpp">用户的下行网络质量评分，基于丢包率、平均往返时延（RTT）和下行网络抖动等指标。详见 <xref keyref="QUALITY_TYPE"/>。</pd>
                </plentry>
            <plentry props="android cpp ios">
                <pt props="android cpp ios">uid</pt>
                <pd props="android">用户 ID，用于标识网络质量报告所属的用户。
                    <ul>
                        <li>0：表示本地用户。</li>
                        </ul>
                    </pd>
                <pd props="ios">用户 ID。该回调报告该用户的网络质量。如果 <ph keyref="uid"/> 为 0，则报告本地用户的网络质量。</pd>
                <pd props="cpp">用户 ID，报告该用户的网络质量。如果该值为 0，则表示本地用户。</pd>
            </plentry>
        </parml> </section>
    </refbody>
</reference>
