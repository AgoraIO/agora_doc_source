<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="api_imediarecorder_startrecording">
    <title>
    <ph keyref="startRecording"/>
  </title>
    <shortdesc id="short">
    <ph id="shortdesc">开始录制音视频流。</ph>
  </shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="startRecording"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
                <codeblock props="cpp" outputclass="language-cpp">virtual int startRecording(const media::MediaRecorderConfiguration&amp; config) = 0;</codeblock>
                <codeblock props="android" outputclass="language-java">public int startRecording(MediaRecorderConfiguration config)</codeblock>
                <codeblock props="ios" outputclass="language-objectivec">- (int)startRecording:(AgoraMediaRecorderConfiguration* _Nonnull)config NS_SWIFT_NAME(startRecording(_:));</codeblock>
                <codeblock props="mac" outputclass="language-objectivec">- (int)startRecording:(AgoraMediaRecorderConfiguration* _Nonnull)config NS_SWIFT_NAME(startRecording(_:));</codeblock>
            </p>
        </section>
        <section id="detailed_desc" deliveryTarget="details" otherprops="no-title">
            <dl outputclass="since">
                <dlentry props="cpp ios mac">
                    <dt>自从</dt>
                    <dd>自 v4.0.0 版本新增。</dd>
                </dlentry>
            </dl>
            <p props="cpp">该方法用于开始录制音频和视频流，支持同时录制本地和远端用户的音视频流。
在调用该方法前，请确保：
                <ul>
                    <li>已通过 <xref keyref="createMediaRecorder"/> 创建录制器实例。</li>
                    <li>已通过 <xref keyref="setMediaRecorderObserver"/> 注册录制器观察者以监听录制回调。</li>
                    <li>已加入频道。
该方法支持录制以下内容：</li>
                    <li>以 AAC 编码格式采集的麦克风音频。</li>
                    <li>以 H.264 或 H.265 编码格式采集的摄像头视频。
录制开始后：</li>
                    <li>如果录制过程中视频分辨率发生变化，SDK 会停止录制。</li>
                    <li>如果音频采样率或声道数发生变化，SDK 会继续录制，并生成一个 MP4 文件。
仅当检测到可录制的音视频流时，录制文件才会成功生成。如果没有可录制的流，或录制过程中流中断超过 5 秒，SDK 会停止录制，并触发 <xref keyref="onRecorderStateChanged"/>（<codeph>RECORDER_STATE_ERROR</codeph>，<codeph>RECORDER_REASON_NO_STREAM</codeph>）回调。</li>
                </ul>
            </p>
            <p props="android">该方法用于开始录制音频和视频流。声网 SDK 支持同时录制本地和远端用户的音视频流。
在调用该方法前，请确保：
                <ul>
                    <li>已使用 <xref keyref="createMediaRecorder"/> 创建媒体录制器对象。</li>
                    <li>已使用 <xref keyref="setMediaRecorderObserver"/> 注册媒体录制器观察者以监听录制相关的回调。</li>
                    <li>已加入频道。
该方法支持录制以下数据：</li>
                    <li>由麦克风采集的音频，格式为 AAC。</li>
                    <li>由摄像头采集的视频，格式为 H.264 或 H.265。
录制开始后，如果视频分辨率发生变化，SDK 会停止录制；如果音频采样率或声道数发生变化，SDK 会继续录制并生成一个 MP4 文件。
仅当检测到可录制的音视频流时，才会生成录制文件。如果没有可录制的流，或录制过程中音视频流中断超过 5 秒，SDK 会停止录制并触发 <xref keyref="onRecorderStateChanged"/>（<codeph>RECORDER_STATE_ERROR</codeph>, <codeph>RECORDER_REASON_NO_STREAM</codeph>）回调。</li>
                </ul>
            </p>
            <p props="ios mac">该方法用于开始录制音频和视频流。声网 SDK 支持同时录制本地和远端用户的音视频流。
在开始录制前，请确保：
                <ul>
                    <li>已调用 <xref keyref="createMediaRecorder"/> 创建媒体录制器对象。</li>
                    <li>已调用 <xref keyref="setMediaRecorderObserver"/> 注册媒体录制器观察者以监听录制相关的回调。</li>
                    <li>已加入频道。
该方法支持录制以下数据：</li>
                    <li>通过麦克风采集的音频，编码格式为 AAC。</li>
                    <li>通过摄像头采集的视频，编码格式为 H.264 或 H.265。
录制开始后，如果录制过程中视频分辨率发生变化，SDK 会停止录制。如果音频采样率或声道数发生变化，SDK 会继续录制并生成一个 MP4 文件。
仅当检测到可录制的音视频流时，才会生成录制文件。如果在录制过程中未检测到可录制的音视频流，或音视频流中断超过 5 秒，SDK 会停止录制并触发 <xref keyref="onRecorderStateChanged"/> 回调（<codeph>AgoraMediaRecorderStateError</codeph>，<codeph>AgoraMediaRecorderReasonCodeNoStream</codeph>）。</li>
                </ul>
            </p>
            <note props="cpp">
                <ul>
                    <li>如果你希望录制本地音视频流，请确保在开始录制前将本地用户角色设置为 <codeph>broadcaster</codeph>。</li>
                    <li>如果你希望录制远端音视频流，请确保在开始录制前已订阅远端用户的流。</li>
                </ul>
            </note>
            <note props="android">
                <ul>
                    <li>如果需要录制本地音视频流，请确保本地用户角色在开始录制前已设置为主播。</li>
                    <li>如果需要录制远端用户的音视频流，请确保在开始录制前已订阅远端用户的音视频流。</li>
                </ul>
            </note>
            <note props="ios mac">
                <ul>
                    <li>如果需要录制本地音视频流，请确保本地用户角色在开始录制前已设置为主播。</li>
                    <li>如果需要录制远端用户的音视频流，请确保在开始录制前已订阅目标用户的音视频流。</li>
                </ul>
            </note>
        </section>
        <section id="timing" deliveryTarget="details">
            <title>调用时机</title>
            <p props="android cpp ios mac">加入频道前后均可调用。</p>
        </section>
        <section id="restriction" deliveryTarget="details">
            <title>调用限制</title>
            <p props="android cpp ios mac">无。</p>
        </section>
        <section id="parameters" deliveryTarget="details">
            <title>参数</title>
            <parml>
                <plentry props="cpp">
                    <pt>config</pt>
                    <pd>音视频流录制配置。详见 <xref keyref="MediaRecorderConfiguration"/>。</pd>
                </plentry>
                <plentry props="android">
                    <pt>config</pt>
                    <pd>音视频流录制的配置。详见 <xref keyref="MediaRecorderConfiguration"/>。</pd>
                </plentry>
                <plentry props="ios mac">
                    <pt>config</pt>
                    <pd>用于配置音视频流录制的参数，详见 <xref keyref="MediaRecorderConfiguration"/>。</pd>
                </plentry>
            </parml>
        </section>
        <section id="return_values">
            <title>返回值</title>
            <p props="cpp">
                <ul>
                    <li>0：方法调用成功。</li>
                    <li>&lt; 0：方法调用失败。
                        <ul>
                            <li>-2：参数无效。请确保：
                                <ul>
                                    <li>指定的录制文件路径正确且可写。</li>
                                    <li>指定的录制文件格式正确。</li>
                                    <li>最大录制时长设置正确。</li>
                                </ul>
                            </li>
                            <li>-4：<xref keyref="IRtcEngine"/> 当前状态不支持该操作。可能是已有录制正在进行，或录制因错误已停止。</li>
                            <li>-7：调用该方法时 <xref keyref="IRtcEngine"/> 尚未初始化。请确保在调用该方法前已创建 <xref keyref="IMediaRecorder"/> 对象。</li>
                        </ul>
                    </li>
                </ul>
            </p>
            <p props="android">
                <ul>
                    <li>0：方法调用成功。</li>
                    <li>&lt; 0：方法调用失败。详见 <codeph>Error Codes</codeph>。
                        <ul>
                            <li>-2：参数无效。请确保：
                                <ul>
                                    <li>指定的录制文件保存路径正确且可写。</li>
                                    <li>指定的录制文件格式正确。</li>
                                    <li>最大录制时长设置正确。</li>
                                </ul>
                            </li>
                            <li>-4：当前 <xref keyref="IRtcEngine"/> 状态不支持该操作。可能是录制已在进行中，或因错误而停止。</li>
                            <li>-7：在 <xref keyref="IRtcEngine"/> 初始化前调用该方法。请确保在调用该方法前已创建 <xref keyref="IMediaRecorder"/> 对象。</li>
                        </ul>
                    </li>
                </ul>
            </p>
            <p props="ios mac">
                <ul>
                    <li>0：方法调用成功。</li>
                    <li>&lt; 0：方法调用失败。详见错误码：
                        <ul>
                            <li>-2：参数无效。请确保：
                                <ul>
                                    <li>指定的录制文件保存路径正确且可写。</li>
                                    <li>指定的录制文件格式正确。</li>
                                    <li>最大录制时长设置正确。</li>
                                </ul>
                            </li>
                            <li>-4：当前 <xref keyref="IRtcEngine"/> 的状态不支持该操作。可能是由于已有录制任务正在进行，或录制错误导致录制已停止。</li>
                            <li>-7：调用该方法时 <xref keyref="IRtcEngine"/> 尚未初始化。请确保在调用该方法前已创建 <xref keyref="IMediaRecorder"/> 对象。</li>
                        </ul>
                    </li>
                </ul>
            </p>
        </section>
    </refbody>
</reference>