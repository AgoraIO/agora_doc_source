<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="api_irtcengine_startscreencapture">
    <title>
    <ph keyref="startScreenCapture"/>
  </title>
    <shortdesc id="short">
    <ph id="shortdesc">开始屏幕采集。</ph>
  </shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="startScreenCapture"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
                <codeblock props="cpp" outputclass="language-cpp">virtual int startScreenCapture(const ScreenCaptureParameters2&amp; captureParams) = 0;</codeblock>
                <codeblock props="android" outputclass="language-java">public abstract int startScreenCapture(ScreenCaptureParameters screenCaptureParameters);</codeblock>
                <codeblock props="ios" outputclass="language-objectivec">- (int)startScreenCapture:(AgoraScreenCaptureParameters2* _Nullable)parameters  NS_SWIFT_NAME(startScreenCapture(_:));</codeblock>
                <codeblock props="mac" outputclass="language-objectivec">- (int)startScreenCapture:(AgoraVideoSourceType)sourceType config:(AgoraScreenCaptureConfiguration * _Nullable)config NS_SWIFT_NAME(startScreenCapture(_:config:));</codeblock>
            </p>
        </section>
        <section id="detailed_desc" deliveryTarget="details" otherprops="no-title">
            <dl outputclass="since">
                <dlentry props="android">
                    <dt>自从</dt>
                    <dd>自 v3.7.0 版本新增。</dd>
                </dlentry>
            </dl>
            <p props="cpp">在屏幕共享场景中，你需要调用该方法开始采集屏幕视频流。你可以在加入频道前或加入频道后调用该方法，具体如下：
                <ul>
                    <li>先调用该方法，再调用 <codeph>joinChannel</codeph> 加入频道，并将 <codeph>publishScreenCaptureVideo</codeph> 设置为 <xref keyref="true"/>，以开始屏幕共享。</li>
                    <li>加入频道后调用该方法，再调用 <xref keyref="updateChannelMediaOptions"/> 并将 <codeph>publishScreenCaptureVideo</codeph> 设置为 <xref keyref="true"/>，以开始屏幕共享。</li>
                </ul>
            </p>
            <p props="android">你需要在屏幕共享场景中调用此方法以开始采集屏幕视频流。你可以在加入频道前或加入频道后调用此方法，调用时机不同，使用方式如下：
                <ul>
                    <li>先调用 <xref keyref="startScreenCapture"/>，再调用 <codeph>joinChannel</codeph> 加入频道，并将 <codeph>publishScreenCaptureVideo</codeph> 设置为 <xref keyref="true"/>，以开始屏幕共享。</li>
                    <li>加入频道后调用 <xref keyref="startScreenCapture"/>，再调用 <xref keyref="updateChannelMediaOptions"/> 并将 <codeph>publishScreenCaptureVideo</codeph> 设置为 <xref keyref="true"/>，以开始屏幕共享。</li>
                </ul>
            </p>
            <note props="cpp">
                <ul>
                    <li>在 iOS 平台，屏幕共享仅支持 iOS 12.0 及以上版本。</li>
                    <li>如果你使用自定义音频源而非 SDK 采集音频，声网建议你在应用中添加保活处理逻辑，以避免应用进入后台后屏幕共享中断。</li>
                    <li>该功能对设备性能要求较高，声网建议你在 iPhone X 及以上机型上使用。</li>
                    <li>该方法依赖 iOS 屏幕共享动态库 <codeph>AgoraReplayKitExtension.xcframework</codeph>。如果该动态库被删除，屏幕共享将无法正常启用。</li>
                    <li>在 Android 平台，如果用户未授予应用屏幕采集权限，SDK 会触发 <xref keyref="onPermissionError"/> 回调。</li>
                    <li>在 Android 9 及以上版本，为避免应用进入后台后被系统杀死，声网建议你在 <codeph>/app/Manifests/AndroidManifest.xml</codeph> 文件中添加前台服务权限 <codeph>android.permission.FOREGROUND_SERVICE</codeph>。</li>
                    <li>由于性能限制，Android TV 不支持屏幕共享。</li>
                    <li>由于系统限制，使用华为手机时请勿在屏幕共享过程中调整屏幕共享流的视频编码分辨率，否则可能导致崩溃。</li>
                    <li>由于系统限制，部分小米设备在屏幕共享时不支持采集系统音频。</li>
                    <li>为避免屏幕共享时系统音频采集失败，声网建议你在加入频道前通过 <xref keyref="setAudioScenario"/> 方法将音频应用场景设置为 <codeph>AUDIO_SCENARIO_GAME_STREAMING</codeph>。</li>
                    <li>该方法仅适用于 Android 和 iOS 平台。</li>
                    <li>屏幕共享流的计费基于 <xref keyref="ScreenVideoParameters"/> 中的 <codeph>dimensions</codeph>：
                        <ul>
                            <li>如果未传入该值，声网按 1280 × 720 计费。</li>
                            <li>如果传入该值，声网按传入的值计费。</li>
                        </ul>
                    </li>
                </ul>
            </note>
            <note props="android">
                <ul>
                    <li>在 Android 平台，如果用户未授予应用屏幕采集权限，SDK 会触发 <xref keyref="onPermissionError"/> 回调，错误码为 2。</li>
                    <li>在 Android 9 及以上版本，为避免应用进入后台后被系统杀死，声网建议你在 <codeph>/app/Manifests/AndroidManifest.xml</codeph> 文件中添加前台服务权限 <codeph>android.permission.FOREGROUND_SERVICE</codeph>。</li>
                    <li>由于性能限制，Android TV 不支持屏幕共享。</li>
                    <li>由于系统限制，使用华为手机时，屏幕共享过程中请勿调整屏幕共享流的视频编码分辨率，否则可能会导致崩溃。</li>
                    <li>由于系统限制，部分小米设备在屏幕共享时不支持采集系统音频。</li>
                    <li>为避免屏幕共享时系统音频采集失败，声网建议你在加入频道前通过 <xref keyref="setAudioScenario"/> 方法将音频应用场景设置为 <codeph>AUDIO_SCENARIO_GAME_STREAMING</codeph>。</li>
                    <li>屏幕共享流的计费基于 <xref keyref="ScreenVideoParameters"/> 中的 <codeph>dimensions</codeph>：
                        <ul>
                            <li>若未传入该值，声网按 1280 × 720 计费。</li>
                            <li>若传入该值，声网按传入的值计费。</li>
                        </ul>
                    </li>
                </ul>
            </note>
        </section>
        <section id="timing" deliveryTarget="details">
            <title>调用时机</title>
            <p props="android cpp ios mac">加入频道前后均可调用。</p>
        </section>
        <section id="restriction" deliveryTarget="details">
            <title>调用限制</title>
            <p props="android cpp ios mac">无。</p>
        </section>
        <section id="parameters" deliveryTarget="details">
            <title>参数</title>
            <parml>
                <plentry props="cpp">
                    <pt>captureParams</pt>
                    <pd>屏幕共享的编码参数。详见 <xref keyref="ScreenCaptureParameters2"/>。</pd>
                </plentry>
                <plentry props="android">
                    <pt>screenCaptureParameters</pt>
                    <pd>屏幕共享的编码参数。详见 <xref keyref="ScreenCaptureParameters2"/>。</pd>
                </plentry>
                <plentry props="ios">
                    <pt>parameters</pt>
                    <pd>屏幕共享的编码参数。详见 <xref keyref="ScreenCaptureParameters2"/>。</pd>
                </plentry>
                <plentry props="mac">
                    <pt>sourceType</pt>
                    <pd>屏幕来源类型，详见 <xref keyref="VIDEO_SOURCE_TYPE"/>。</pd>
                </plentry>
                <plentry props="mac">
                    <pt>config</pt>
                    <pd>屏幕共享的配置，详见 <codeph>AgoraScreenCaptureConfiguration</codeph>。</pd>
                </plentry>
            </parml>
        </section>
        <section id="return_values">
            <title>返回值</title>
            <p props="cpp">
                <ul>
                    <li>0：方法调用成功。</li>
                    <li>&lt; 0：方法调用失败。
                        <ul>
                            <li>-2（iOS 平台）：参数为空。</li>
                            <li>-2（Android 平台）：系统版本过低。请确保 Android API 级别不低于 21。</li>
                            <li>-3（Android 平台）：无法采集系统音频。请确保 Android API 级别不低于 29。</li>
                        </ul>
                    </li>
                </ul>
            </p>
            <p props="android">
                <ul>
                    <li>0：方法调用成功。</li>
                    <li>&lt; 0：方法调用失败。
                        <ul>
                            <li>-2：系统版本过低。请确保 Android API 级别不低于 21。</li>
                            <li>-3：无法采集系统音频。请确保 Android API 级别不低于 29。</li>
                        </ul>
                    </li>
                </ul>
            </p>
            <p props="ios mac">
                <ul>
                    <li>0：方法调用成功。</li>
                    <li>&lt; 0：方法调用失败。</li>
                </ul>
            </p>
        </section>
    </refbody>
</reference>