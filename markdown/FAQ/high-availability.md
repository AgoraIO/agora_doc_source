---
title: 云端录制如何处理服务器断网、进程被杀问题？
platform: ["RESTful"]
updatedAt: 2020-07-09 21:23:40
Products: ["cloud-recording"]
---

当出现服务器断网、进程被杀时，云端录制会启用高可用机制，在 90 秒内切换到新的服务器，自动恢复录制服务。

## 为什么录制文件的文件名发生了变化？

启用高可用机制后，会生成新的 M3U8 文件，包含录制服务恢复之后的切片文件索引信息。文件名增加` bak<n>`前缀，`n` 为高可用机制在该次录制中被启用的 index, 0 表示第一次启用。

例如，在合流模式下，M3U8 文件的文件名为 `<sid>_<cname>.m3u8`。在第一次启用高可用机制后，会生成新的 M3U8 文件，文件名为 `bak0_<sid>_<cname>.m3u8`。

启用高可用机制后，录制生成的 TS/WebM 文件的文件名也会增加 `bak<n>` 前缀。

> 一次录制最多可启用 3 次高可用机制，在第四次出现断网或进程被杀后，云端录制不会再尝试恢复录制。

## 为什么调用 query 会返回 404？

云端录制启用高可用机制后，故障处理中心需要一段时间用于判断故障原因，并采取相应的应对措施。当后台检测到服务器进程被杀时，会在 30 秒内将服务切换到另一台服务器。当检测到服务器断网时，会首先在一分钟内尝试重连。如果一分钟后依然无法连接到服务器，云端录制会将服务切换到另一台服务器。在录制服务恢复之前，调用 `query`、`updateLayout`、或 `stop` 均会返回 404。

## 为什么回调通知中的 UID 不是我设置的录制 UID?

当启用了高可用机制，并将服务切换到一台新的服务器后，云端录制会随机指定一个新的录制 UID 加入录制的频道，旧的录制 UID 会被弃用。
