页面录制场景下，网络异常等偶然因素可能会造成以下问题：

- 无法正常访问待录制页面，如页面加载失败或时间过长。针对该问题，声网提供[页面加载超时检测功能](https://docs.agora.io/cn/cloud-recording/cloud_recording_webpage_load_timeout?platform=RESTful)。
- 可以正常访问待录制页面，但未能正确加载页面中的 HTML 元素。
- 录制过程中未能正常加载页面中发生变化的 HTML 元素。
- 未能正常播放待录制页面中的音视频。
- 页面录制异常停止。

为了避免上述问题导致的录制内容与预期不一致，声网建议你按照以下方案保障页面录制的可靠性。


## 录制启动时的保障

建议你通过如下步骤确认录制服务已成功启动：

1. 确认 [`start`](https://docs.agora.io/cn/cloud-recording/cloud_recording_api_start) 请求成功，即成功获得 sid (录制 ID)。如果 `start` 请求失败，需要根据状态码采取相应措施：
   - 如果返回的 HTTP 状态码为 `40x`，则表示请求参数错误，需要进行排查。
   - 如果返回的 HTTP 状态码为 `50x`，可使用相同的参数重试多次，直到成功返回 `sid` 为止。建议使用退避策略，如第一次等待 3 秒后重试、第二次等待 6 秒后重试、第三次等待 9 秒后重试，以免超过 QPS 限制导致失败。如果三次重试均失败，建议更换 UID 再次调用 `acquire`， 获得一个新的 resource ID，并用该 resource ID 再次调用 `start` 方法。
   - 如果收到错误码 `65`，需要使用相同的参数再次调用 `start`。建议使用退避策略重试两次，如第一次等待 3 秒后重试、第二次等待 6 秒后重试。
2. 获得 `sid` 之后的 5 秒后，使用退避策略调用 query 方法，例如依次间隔 5 秒、10 秒、15 秒调用。如果 `query` 请求成功，且 `serverResponse` 中的 `status` 参数值为 `4` 或 `5`，则表示录制服务已成功启动。如果在获得 `sid` 之后的 90 秒后 `status` 仍非 `4` 或 `5`， 则可以认为录制未启动或成功后超时退出。

### 录制页面加载时的保障

### 定时检测待录制页面是否加载成功
开始页面录制前，你需要自行完成待录制页面的检测逻辑，以实现以下方案：
1. 调用 `start` 开始页面录制时，页面录制浏览器访问并加载待录制页面。
2. 页面录制服务执行待录制页面 Javascript 的页面检测逻辑，当页面元素加载符合你的预期时，页面录制服务回调 `sid`（录制周期的唯一标识）通知业务服务端录制服务启动成功。
3. 待录制页面定期上报状态，通知业务服务端页面内容变化。

<img src="https://web-cdn.agora.io/docs-files/1634546269689" style="zoom:50%;" />

## 待录制页面加载失败的处理措施

在实现待录制页面检测逻辑的前提下，当待录制页面录制加载失败，业务服务端未收到回调时，声网推荐你重新发起录制请求。
<img src="https://web-cdn.agora.io/docs-files/1634546363188" style="zoom:60%;" />

## 录制异常停止的保障

开通消息通知服务并订阅 [`71 web_recorder_stopped`](https://docs.agora.io/cn/cloud-recording/cloud_recording_callback_rest?platform=RESTful#a-name71a71-web_recorder_stopped) 回调事件，当业务服务器收到 `web_recorder_stopped` 回调，且 code 不为 `0`，表示页面录制异常停止，声网推荐你重新发起新的录制。
<img src="https://web-cdn.agora.io/docs-files/1634546429005" style="zoom:50%;" />

