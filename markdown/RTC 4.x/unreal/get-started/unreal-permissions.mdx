---
title:  如何为 Unreal Engine 项目添加实时互动所需的权限？
products:
  - rtc
platforms:
  - unreal-cpp
  - unreal-blueprint
categories:
  - integration-issues
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';



本文介绍根据不同的目标平台，为你的 Unreal Engine 项目添加实时互动所需的权限。



## iOS

如果目标平台是 iOS，参考以下步骤为你的 UE 项目添加实时互动所需的摄像头和麦克风权限：

1. 在 **Unreal Editor** 中，点击 **Edit > Project Settings > Platforms > iOS** 打包项目，粘贴以下代码到 **Additional Plist Data** 输入框中：

    ```xml
    <key>NSCameraUsageDescription</key><string>AgoraVideoCall</string><key>NSMicrophoneUsageDescription</key><string>AgoraVideoCall</string>
    ```

2. 在 `Project/Source/Project.Target.cs` 中，添加如下代码：

    ```cpp
    public class AgoraExampleTarget : TargetRules
    {
      public AgoraExampleTarget( TargetInfo Target) : base(Target)
      {
        Type = TargetType.Game;
        DefaultBuildSettings = BuildSettingsVersion.V2;
        if (Target.Platform == UnrealTargetPlatform.IOS)
        {
          bOverrideBuildEnvironment = true;
          GlobalDefinitions.Add("FORCE_ANSI_ALLOCATOR=1");
        }
        ExtraModuleNames.AddRange( new string[] { "AgoraExample" } );
      }
    }
    ```



## macOS

如果目标平台是 macOS，参考以下步骤为你的 UE 项目添加实时互动所需的摄像头和麦克风权限：

1. 在 **Unreal Editor** 中，点击 **Edit > Project Settings > Platforms > Mac** 打包项目。右击编译生成的应用程序文件 (`.app`)，选择 **Show Package Contents** 显示包内容。

    <Image src="/img/rtc/ue-showcontentpackages.png" width="60%"/>  

2. 用 **Xcode** 打开后缀为 `.xcworkspace` 的项目文件，选择 **TARGETS > Build Settings > Packaging**，设置 **Generate Info.plist File** 为 **Yes**，生成 `Info.plist` 文件。

    <Image src="/img/rtc/ue-generate-infoplist.png" width="80%"/>  

3. (可选) 如果你使用的是搭载 M1 或 M2 芯片的 Mac 设备，你需要[安装 Rosetta](https://support.apple.com/zh-cn/HT211861)，并选择 **Product > Destination > Destination Architecture** 为 **Show Both**。

    <Image src="/img/rtc/ue-arch-showboth.gif" width="80%"/>  

4. 在 `Info.plist` 文件的 **Information Property List** 中添加如下摄像头和麦克风隐私权限：

    - Privacy - Camera Usage Description：摄像头使用权限
    - Privacy - Microphone Usage Description：麦克风使用权限

    <Tabs>
      <TabItem value="method1" label="方式一">
        在 **Xcode** 中双击打开 `Info.plist` 文件，在 **Information Property List** 下添加摄像头和麦克风隐私权限：

          <Image src="/img/rtc/ue-infoplist.gif" width="80%"/>  

      </TabItem>
      <TabItem value="method2" label="方式二">
        使用文本编辑器打开 `Info.plist` 文件，添加以下 XML 片段：

            ```xml
            <key>NSCameraUsageDescription</key>
            <string>Use camera</string>
            <key>NSMicrophoneUsageDescription</key>
            <string>Use mic</string>
            ```

      </TabItem>
    </Tabs>

5. 把声网 UE 插件 `/AgoraPlugin/Source/ThirdParty/AgoraPluginLibrary/Mac/Release` 路径下的库 (`.framework`) 全部复制到打包项目的 `/MacNoEditor/xxx/Contents/MacOS` 路径下。

    <Image src="/img/rtc/ue-add-framework.png" width="80%"/>  



## Android

如果目标平台是 Android，参考以下步骤为你的 UE 项目添加如下实时互动所需的权限：

    - `android.permission.RECORD_AUDIO`：录音权限。
    - `android.permission.CAMERA`：相机权限。
    - `android.permission.READ_PHONE_STATE`：读取电话状态权限。
    - `android.permission.WRITE_EXTERNAL_STORAGE`：写入外部存储权限。

    <Tabs>
      <TabItem value="cpp" label="C++">

        在你的项目文件中添加如下代码，在初始化 RTC 引擎前，检查是否已获取实时互动所需的 Android 系统权限。

          ```cpp
          void UAgoraVideoWidget::CheckAndroidPermission()
          {
          #if PLATFORM_ANDROID
            FString pathfromName = UGameplayStatics::GetPlatformName();
            if (pathfromName == "Android")
            {
              TArray<FString> AndroidPermission;
              AndroidPermission.Add(FString("android.permission.CAMERA"));
              AndroidPermission.Add(FString("android.permission.RECORD_AUDIO"));
              AndroidPermission.Add(FString("android.permission.READ_PHONE_STATE"));
              AndroidPermission.Add(FString("android.permission.WRITE_EXTERNAL_STORAGE"));
              UAndroidPermissionFunctionLibrary::AcquirePermissions(AndroidPermission);
            }
          #endif
          }
          ```

      </TabItem>
      <TabItem value="bp" label="Blueprint">
        
        在初始化 RTC 引擎前，需要检查是否已获取实现实时互动所需的 Android 系统权限。你可以参照下图创建节点，用于添加 Android 系统中访问麦克风、访问摄像头等权限。

          <Image src="https://web-cdn.agora.io/docs-files/1689838387857" alt="" />

      </TabItem>
    </Tabs>